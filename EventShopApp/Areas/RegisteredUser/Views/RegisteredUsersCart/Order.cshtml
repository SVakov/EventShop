@model EventShopApp.ViewModels.OrderViewModel

<h2>Order Form</h2>

<form id="orderForm" method="post">
    @Html.AntiForgeryToken()
    <div class="form-group">
        <label>Name</label>
        <input type="text" name="Name" value="@Model.Name" class="form-control" required />
    </div>
    <div class="form-group">
        <label>Surname</label>
        <input type="text" name="Surname" value="@Model.Surname" class="form-control" />
    </div>
    <div class="form-group">
        <label>Phone Number</label>
        <input type="tel" name="PhoneNumber" value="@Model.PhoneNumber" class="form-control" required />
    </div>
    <div class="form-group">
        <label>Email</label>
        <input type="email" name="Email" value="@Model.Email" class="form-control" readonly />
    </div>
    <div class="form-group">
        <label>Address</label>
        <input type="text" name="Address" value="@Model.Address" class="form-control" />
    </div>
    <div class="form-group">
        <label>Deadline Date</label>
        <input type="date" name="DeadLineDate" value="@Model.DeadLineDate" class="form-control" required />
    </div>

    <button type="button" class="btn btn-primary" onclick="submitOrder()">Order</button>
    <button type="button" class="btn btn-secondary" onclick="redirectToCart()">Close</button>
</form>

<script>
    function redirectToCart() {
        window.location.href = '/RegisteredUser/RegisteredUsersCart';
    }

    function submitOrder() {
        const form = document.querySelector('#orderForm');
        const formData = new FormData(form);

        fetch('/RegisteredUser/RegisteredUsersCart/SubmitOrder', {
            method: 'POST',
            body: formData,
            headers: {
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    
                    window.location.href = '/RegisteredUser/RegisteredUsersCart/OrderConfirmation';
                } else {
                    alert('Failed to submit order. Please try again.');
                }
            })
            .catch(error => console.error('Error:', error));
    }

    document.getElementById('orderButton').addEventListener('click', function () {
        const form = document.querySelector('#orderForm');
        const formData = new FormData(form);

        fetch('/RegisteredUser/RegisteredUsersCart/SubmitOrder', {
            method: 'POST',
            body: formData,
            headers: {
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log("Order submitted successfully!");
                    window.location.href = data.redirectUrl; // Redirect to the confirmation page
                } else {
                    alert(data.message || "Failed to submit order. Please try again.");
                }
            })
            .catch(error => console.error('Error:', error));
    });
</script>
